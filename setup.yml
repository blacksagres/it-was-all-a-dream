- name: Dev Machine Setup ğŸ––
  hosts: localhost
  tasks:
    # --- Debian/Ubuntu ---

    - name: Install btop (Debian) âš™ï¸
      ansible.builtin.apt:
        name: btop
        state: present
      become: yes
      when: ansible_os_family == "Debian"

    - name: Install fastfetch (Debian) ğŸª„
      ansible.builtin.apt:
        name: fastfetch
        state: present
      become: yes
      when: ansible_os_family == "Debian"

    - name: Install fzf (Debian) ğŸ”
      ansible.builtin.apt:
        name: fzf
        state: present
      become: yes
      when: ansible_os_family == "Debian"

    - name: Install tmux (Debian) ğŸ’»
      ansible.builtin.apt:
        name: tmux
        state: present
      become: yes
      when: ansible_os_family == "Debian"

    # --- macOS ---

    - name: Install btop (macOS) âš™ï¸
      ansible.builtin.shell: brew install btop
      when: ansible_os_family == "Darwin"

    - name: Install fastfetch (macOS) ğŸª„
      ansible.builtin.shell: brew install fastfetch
      when: ansible_os_family == "Darwin"

    - name: Install fzf (macOS) ğŸ”
      ansible.builtin.shell: brew install fzf
      when: ansible_os_family == "Darwin"

    - name: Install tmux (macOS) ğŸ’»
      ansible.builtin.shell: brew install tmux
      when: ansible_os_family == "Darwin"

    # --- Cross-platform ---

    - name: Remove existing catpuccin folder, if any ğŸ§¨
      ansible.builtin.shell: |
        rm -rf ~/.config/tmux/plugins/catppuccin

    - name: Remove existing .tmux folder, if any ğŸ§¨
      ansible.builtin.shell: |
        rm -rf ~/.tmux

    - name: Oh my tmux! ğŸˆâ€â¬›
      ansible.builtin.shell: |
        git clone https://github.com/gpakosz/.tmux.git ~/.tmux

    - name: Create symlink for .tmux.conf ğŸˆâ€â¬›
      ansible.builtin.shell: |
        ln -sf ~/.tmux/.tmux.conf ~/.tmux.conf

    - name: Reload tmux configuration ğŸˆâ€â¬›
      ansible.builtin.shell: |
        tmux source-file ~/.tmux.conf
      ignore_errors: yes

    - name: Install nvm
      ansible.builtin.shell: |
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh | bash
      args:
        creates: "{{ lookup('ansible.builtin.env', 'HOME') }}/.nvm/nvm.sh"

    - name: Install npm using nvm
      ansible.builtin.shell: |
        export NVM_DIR="{{ lookup('ansible.builtin.env', 'HOME') }}/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        nvm install --lts
      args:
        creates: "{{ lookup('ansible.builtin.env', 'HOME') }}/.nvm/versions/node"
